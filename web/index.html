<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rover System Health Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: white;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .btn {
      padding: 15px 30px;
      font-size: 18px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .btn-primary {
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      color: white;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }
    
    .status-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      min-height: 200px;
    }
    
    .status-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    }
    
    .status-title {
      font-size: 1.5em;
      font-weight: bold;
    }
    
    .timestamp {
      font-size: 0.9em;
      opacity: 0.8;
    }
    
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      gap: 10px;
    }
    
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .test-results {
      display: grid;
      gap: 15px;
    }
    
    .test-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      border-left: 4px solid transparent;
      transition: all 0.3s ease;
    }
    
    .test-item.pass {
      border-left-color: #00d4aa;
      background: rgba(0, 212, 170, 0.1);
    }
    
    .test-item.warn {
      border-left-color: #ffa726;
      background: rgba(255, 167, 38, 0.1);
    }
    
    .test-item.fail {
      border-left-color: #ff5252;
      background: rgba(255, 82, 82, 0.1);
    }
    
    .test-name {
      font-weight: bold;
      text-transform: capitalize;
    }
    
    .test-result {
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }
    
    .overall-status {
      text-align: center;
      font-size: 2em;
      font-weight: bold;
      margin: 20px 0;
      padding: 20px;
      border-radius: 15px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .overall-status.pass {
      background: rgba(0, 212, 170, 0.2);
      color: #00d4aa;
    }
    
    .overall-status.warn {
      background: rgba(255, 167, 38, 0.2);
      color: #ffa726;
    }
    
    .overall-status.fail {
      background: rgba(255, 82, 82, 0.2);
      color: #ff5252;
    }
    
    .error-message {
      background: rgba(255, 82, 82, 0.2);
      color: #ff5252;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(255, 82, 82, 0.3);
      margin: 20px 0;
    }
    
    .instructions {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin-top: 30px;
      font-size: 0.9em;
      line-height: 1.6;
    }
    
    .instructions h3 {
      margin-bottom: 15px;
      color: #ffa726;
    }
    
    .instructions code {
      background: rgba(0, 0, 0, 0.3);
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üöÄ Rover System Health Dashboard</h1>
      <p>One-button comprehensive system testing</p>
    </div>

    <div class="controls">
      <button class="btn btn-primary" onclick="runTests()">
        üîç Run All Tests
      </button>
      <button class="btn btn-secondary" onclick="clearResults()">
        üóëÔ∏è Clear Results
      </button>
    </div>

    <div class="status-section">
      <div class="status-header">
        <div class="status-title">System Status</div>
        <div class="timestamp" id="timestamp"></div>
      </div>
      <div id="status">
        <div style="text-align: center; padding: 40px; opacity: 0.7;">
          <h3>Ready to run tests</h3>
          <p>Click "Run All Tests" to begin comprehensive system validation</p>
        </div>
      </div>
    </div>

    <div class="instructions">
      <h3>üìã Setup Instructions</h3>
      <p><strong>1. Start the test backend:</strong></p>
      <p><code>ros2 launch rover_system_tests full_test_dashboard.launch.py</code></p>
      <br>
      <p><strong>2. For real-time updates, run:</strong></p>
      <p><code>ros2 topic echo /tests/summary</code></p>
      <br>
      <p><strong>Note:</strong> This dashboard currently shows simulated results. Connect it to the ROS 2 topic <code>/tests/summary</code> for live data.</p>
    </div>
  </div>

  <script>
    let isRunning = false;

    function updateTimestamp() {
      document.getElementById('timestamp').textContent = 
        `Last updated: ${new Date().toLocaleString()}`;
    }

    function runTests() {
      if (isRunning) return;
      
      isRunning = true;
      const statusDiv = document.getElementById('status');
      const btn = document.querySelector('.btn-primary');
      
      // Update button state
      btn.textContent = '‚è≥ Running Tests...';
      btn.disabled = true;
      
      // Show loading state
      statusDiv.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          Running comprehensive system tests...
        </div>
      `;
      
      updateTimestamp();
      
      // Simulate test execution (replace with actual ROS 2 service call)
      setTimeout(() => {
        simulateTestResults();
        
        // Reset button state
        btn.textContent = 'üîç Run All Tests';
        btn.disabled = false;
        isRunning = false;
      }, 3000);
    }

    function simulateTestResults() {
      // Simulated test results (replace with actual ROS 2 data)
      const results = {
        overall_status: "WARN",
        tests_passed: "5/6",
        details: {
          ros2_doctor: "PASS - All checks passed",
          active_nodes: "PASS - 3 nodes active",
          active_topics: "PASS - 8 topics available", 
          actuators: "PASS - Actuators nominal (simulated)",
          sensors: "PASS - Sensors nominal (simulated)",
          system_resources: "WARN - High memory usage detected"
        }
      };

      displayResults(results);
      updateTimestamp();
    }

    function displayResults(data) {
      const statusDiv = document.getElementById('status');
      
      // Overall status
      const overallClass = data.overall_status.toLowerCase();
      const statusEmoji = overallClass === 'pass' ? '‚úÖ' : 
                         overallClass === 'warn' ? '‚ö†Ô∏è' : '‚ùå';
      
      let html = `
        <div class="overall-status ${overallClass}">
          ${statusEmoji} System Status: ${data.overall_status}
          <br>
          <div style="font-size: 0.6em; margin-top: 10px;">
            Tests Passed: ${data.tests_passed}
          </div>
        </div>
        <div class="test-results">
      `;
      
      // Individual test results
      for (const [testName, result] of Object.entries(data.details)) {
        const status = result.startsWith('PASS') ? 'pass' : 
                      result.startsWith('WARN') ? 'warn' : 'fail';
        const emoji = status === 'pass' ? '‚úÖ' : 
                     status === 'warn' ? '‚ö†Ô∏è' : '‚ùå';
        
        html += `
          <div class="test-item ${status}">
            <div class="test-name">${emoji} ${testName.replace(/_/g, ' ')}</div>
            <div class="test-result">${result}</div>
          </div>
        `;
      }
      
      html += '</div>';
      statusDiv.innerHTML = html;
    }

    function clearResults() {
      document.getElementById('status').innerHTML = `
        <div style="text-align: center; padding: 40px; opacity: 0.7;">
          <h3>Ready to run tests</h3>
          <p>Click "Run All Tests" to begin comprehensive system validation</p>
        </div>
      `;
      document.getElementById('timestamp').textContent = '';
    }

    // Auto-refresh functionality (for future ROS 2 integration)
    function connectToROS2() {
      // Future: WebSocket or HTTP polling to ROS 2 bridge
      // For now, this is a placeholder
      console.log('ROS 2 connection would be established here');
    }

    // Initialize
    window.onload = function() {
      connectToROS2();
    };
  </script>
</body>
</html>
